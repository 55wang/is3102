<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:em="http://xmlns.jcp.org/jsf/composite/emcomp"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <!--shift + ctrl + F, format-->
    <f:view>
        <h:head>
            <title>Facelet Title</title>
            <em:cssImport></em:cssImport>
            <link type="text/css" rel="stylesheet" href="chat.css"/>
        </h:head>
        <h:body>
            <em:staffNavBar context="message"></em:staffNavBar>
            <em:staffSideBar top="message" side="chat"></em:staffSideBar>
            <div class="container">
                <p:growl id="growl" showDetail="true" />
                <!-- Write My Own Logic -->

                <!--receive event from channel-->
                <!--onMessage="handleMessage" This calls a js function-->
                <p:socket channel="/chat/#{staffUserManagedBean.userName}" widgetVar='subscriber' onMessage="handleConversation" />
                <!--Add socket here maybe just one channel for self-->
                <div id="conversations-container">
                    <div id="new-conversation">
                        <div class="v-center text-center full-width font-20">
                            Add new Conversation
                        </div>
                    </div>
                    <div id="old-conversations">
                        <c:forEach items="#{chatViewManagedBean.conversations}" var="conversation">
                            <!-- Can be modeled by jQuery -->
                            <div class="conversation" onclick="redirect(#{conversation.id})">
                                <div class="user-icon">
                                    <div class="icon-text">
                                        #{conversation.receiver.nameLabel}
                                    </div>
                                </div>
                                <div class="conversation-text">
                                    <div class="conversation-username">
                                        <b>#{conversation.receiver.fullName}</b>
                                    </div>
                                    <div class="conversation-preview">
                                        #{conversation.messages[0].message}
                                    </div>
                                </div>
                            </div>
                        </c:forEach>
                    </div>
                </div>
                <div id="staff-list-container">
                    <h:form>
                        <p:outputLabel value="Search:" for="search-staff" />
                        <p:inputText id="search-staff" value="#{chatViewManagedBean.searchText}" required="true" />
                        <p:commandButton value="Send" actionListener="#{chatViewManagedBean.search}"/>
                    </h:form>
                    <p:panel header="Staffs">
                        <p:dataTable id="staff-list" value="#{chatViewManagedBean.staffs}" var="staff">
                            <p:column headerText="Name" sortBy="#{staff.username}">
                                <h:outputText value="#{staff.username}"></h:outputText>
                            </p:column>
                            <p:column headerText="First" sortBy="#{staff.firstName}">
                                <h:outputText value="#{staff.firstName}"></h:outputText>
                            </p:column>
                            <p:column headerText="Last" sortBy="#{staff.lastName}">
                                <h:outputText value="#{staff.lastName}"></h:outputText>
                            </p:column>
                            <p:column headerText="" sortBy="#{staff.username}">
                                <h:form>
                                    <p:commandButton value="New Message" actionListener="#{chatViewManagedBean.newConversation(staff)}"/>
                                </h:form>
                            </p:column>
                        </p:dataTable>
                    </p:panel>
                </div>
            </div>
            <div id="output"></div>

            <!--To use jquery with javascript here-->
            <h:outputScript library="primefaces" name="jquery/jquery.js" />
            <script type="text/javascript" src="chat.js"></script>
        </h:body>
    </f:view>
</html>

